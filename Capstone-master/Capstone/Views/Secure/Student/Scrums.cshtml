@model Capstone.ViewModels.StudentScrumModel

@{
    Layout = "~/Views/Shared/_TempleScrumHeader.cshtml";
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/pages-student.css"> <!-- Link to your CSS file -->

    <title>Temple Scrum</title>
</head>
<body>

    <div class="content-tittle">
        <h1>Scrum Report Page</h1>
    </div>

    <div class="content-container">

        <button class="hamburger-menu" onclick="toggleNav()" aria-label="Open navigation menu">☰</button>

        <nav class="sidenav" id="navLinks">
            <a asp-controller="Student" asp-action="Dashboard">Dashboard</a> @* Student Home Page *@
            <a asp-controller="Student" asp-action="Scrums">Scrums</a> @* Student Report Management Page *@
            <a asp-controller="Login" asp-action="Login">Logout</a>

        </nav>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Scrum</th>
                        <th>Due Date</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Scrum scrum in Model.Scrums)
                    {
                        // Check if response exists for this scrum
                        int responseID = 0;
                        foreach (Response response in Model.Responses)
                        {
                            if (response.ScrumID == scrum.ID)
                            {
                                responseID = response.ID;
                                break;
                            }
                        }

                        bool isPastDue = scrum.DateDue < DateTime.Now;
                        string dueDateColor = isPastDue ? "color:red;" : "color:black;";

                        <tr>
                            <td>@scrum.Name</td>
                            <td style="@dueDateColor">@scrum.DateDue.ToString("M/d/yyyy")</td>
                            <td>
                                @if (responseID == 0)
                                {
                                    // No response submitted yet
                                    if (isPastDue)
                                    {
                                        // Past due and no response
                                        <a asp-controller="Student" asp-action="Response"
                                           asp-route-id="@scrum.ID" asp-route-responseid="@responseID"
                                           class="btn btn-primary" style="color:white; text-decoration:none;">
                                            Respond
                                        </a>
                                    }
                                    else
                                    {
                                    // Not past due and no response
                                            <a asp-controller="Student" asp-action="Response"
                                           asp-route-id="@scrum.ID" asp-route-responseid="@responseID"
                                               class="btn btn-primary" style="color:white; text-decoration:none;">
                                               Respond
                                            </a>
                                    }
                                }
                                else
                                {
                                    // Response submitted
                                    if (isPastDue)
                                    {
                                        // Response submitted but past the due date
                                        <button class="btn btn-secondary" disabled>
                                            Edit Response
                                        </button>
                                    }
                                    else
                                    {
                                        // Response submitted and before the due date
                                            <a asp-controller="Student" asp-action="Response"
                                           asp-route-id="@scrum.ID" asp-route-responseid="@responseID"
                                                class="btn btn-primary" style="color:white; text-decoration:none;">
                                                Edit Response
                                            </a>
                                    }
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>

    <script>

        function toggleNav() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }
    </script>

</body>
</html>